<script lang="ts" setup>

import { computed, ref } from "#imports";

const formElement = ref<HTMLFormElement | null>();

const amount = ref(50);
const currency = ref('UAH');
const tag = ref('');
const next = ref('');


const isValidNextURL = computed(() => {
  if (!next.value.trim()) {
    return false;
  }

  if (!next.value.trim().startsWith('http')) {
    return false;
  }

  try {
    new URL(next.value);
    return true;
  } catch (_) {
    return false;
  }
});

const isFormValid = computed(() =>
    amount.value > 0
    && ['UAH', 'USD', 'EUR'].includes(currency.value)
    && !!tag.value?.trim()
    && isValidNextURL.value,
);


const donationUrl = computed(() => {
  const baseURL = new URL('https://subscribe.comebackalive.in.ua/pay');
  baseURL.searchParams.set('amount', amount.value.toString());
  baseURL.searchParams.set('currency', currency.value.toString());
  baseURL.searchParams.set('tag', tag.value.toString());
  baseURL.searchParams.set('next', next.value.toString());

  return isFormValid.value ? baseURL.toString() : '';
});


const reportUrl = computed(() => {
  const baseURL = new URL('https://report.comebackalive.in.ua/public/dashboard/a297a107-6740-4b69-9603-f91703f7afba');
  baseURL.searchParams.set('tag', tag.value.toString());

  return isFormValid.value ? baseURL.toString() : '';
});
</script>

<template>
  <div class="container py-3">

    <h1>
      –ü–ª–∞—Ç–Ω–∏–π –µ–∫—Ä–∞–Ω –Ω–∞ –∫–æ—Ä–∏—Å—Ç—å —Ñ–æ–Ω–¥—É
      <br>
      <a href="https://savelife.in.ua/" target="_blank">–ü–æ–≤–µ—Ä–Ω–∏—Å—å –ñ–∏–≤–∏–º</a>
    </h1>

    <p>
      –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–∫—Ä–∏—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç, —è–∫–∏–π –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –ø—ñ—Å–ª—è –ø–æ–∂–µ—Ä—Ç–≤–∏ —É —Ñ–æ–Ω–¥ –ü–æ–≤–µ—Ä–Ω–∏—Å—å –ñ–∏–≤–∏–º
    </p>

    <details class="mb-3">
      <summary>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î</summary>
      <ol>
        <li>–í–∏ –∑–∞–ø–æ–≤–Ω—é—î—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂—á–µ –≤–∫–∞–∑–∞–≤—à–∏ –∫—É–¥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–≤–∏–Ω–µ–Ω –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –ø—ñ—Å–ª—è –ø–æ–∂–µ—Ä—Ç–≤–∏, —Ä–æ–∑–º—ñ—Ä –ø–æ–∂–µ—Ä—Ç–≤–∏</li>
        <li>–ü—ñ–¥ —Ñ–æ—Ä–º–æ—é –¥–ª—è –≤–∞—Å –±—É–¥–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ URL –∞–¥—Ä–µ—Å–∞</li>
        <li>–ü–µ—Ä–µ–π—à–æ–≤—à–∏ –∑–∞ —Ü—ñ—î—é –∞–¥—Ä–µ—Å–æ—é, –≤–∞—à–æ–º—É –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—É –±—É–¥–µ –∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–æ –≤–Ω–µ—Å—Ç–∏ –ø–æ–∂–µ—Ä—Ç–≤—É —É —Ñ–æ–Ω–¥ –ü–æ–≤–µ—Ä–Ω–∏—Å—å –ñ–∏–≤–∏–º –≤–∏–∑–Ω–∞—á–µ–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É</li>
        <li>–ü—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ –æ–ø–ª–∞—Ç—É –±—É–¥–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ –π–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –∑–∞ –∞–¥—Ä–µ—Å–æ—é –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</li>
      </ol>
    </details>

    <form class="was-validated mb-3" ref="formElement">

      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">–ê–¥—Ä–µ—Å–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label>
        <input type="url" v-model="next" class="form-control" required placeholder="https://‚Ä¶">
        <div id="emailHelp" class="form-text">–ù–∞ —Ü—é –∞–¥—Ä–µ—Å—É –±—É–¥–µ –ø–µ—Ä–µ—Å–ø—Ä—è–º–æ–≤–∞–Ω–æ –ª—é–¥–∏–Ω—É –ø—ñ—Å–ª—è –ø–æ–∂–µ—Ä—Ç–≤–∏</div>
      </div>

      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Ç–µ–≥</label>
        <input type="search" v-model="tag" class="form-control" required>
        <div id="emailHelp" class="form-text">–í–∫–∞–∂—ñ—Ç—å —Ç–µ–≥ –¥–ª—è —Ü—å–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è. –°–ª—É–≥—É—î –¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ –∑–≤—ñ—Ç—ñ–≤</div>
      </div>

      <div class="mb-3">
        <label for="amount" class="form-label">–í–∞–ª—é—Ç–∞ —Ç–∞ —Ä–æ–∑–º—ñ—Ä –ø–æ–∂–µ—Ä—Ç–≤–∏</label>
        <div class="input-group mb-3">
          <select class="input-group-text" v-model="currency" required>
            <option>UAH</option>
            <option>USD</option>
            <option>EUR</option>
          </select>
          <input type="number" class="form-control" required v-model="amount">
        </div>
      </div>

    </form>

    <div class="mb-3">
      <label for="staticEmail" class="form-label">–í–∞—à–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–∂–µ—Ä—Ç–≤—É</label>
      <div class="input-group">
        <input type="url" readonly class="form-control" id="staticEmail" :value="donationUrl">
        <a target="_blank" v-if="donationUrl" :href="donationUrl" class="input-group-text">üîó</a>
      </div>
    </div>


    <div class="mb-3">
      <label for="staticEmail" class="form-label">–ó–≤—ñ—Ç –ø–æ–∂–µ—Ä—Ç–≤ —Ç—É—Ç</label>
      <div class="input-group">
        <input type="url" readonly class="form-control" id="staticEmail" :value="reportUrl">
        <a target="_blank" v-if="reportUrl" :href="reportUrl" class="input-group-text">üîó</a>
      </div>
    </div>

  </div>
</template>

<style lang="scss">

$container-max-widths : (
    sm: 540px,
    md: 720px,
    lg: 720px,
    xl: 720px,
    xxl: 720px
);

$h1-font-size         : 2rem;

// Functions first
//@import "../node_modules/bootstrap/scss/bootstrap";

// 1. Include functions first (so you can manipulate colors, SVGs, calc, etc)
@import "../node_modules/bootstrap/scss/functions";

// 2. Include any default variable overrides here

// 3. Include remainder of required Bootstrap stylesheets
@import "../node_modules/bootstrap/scss/variables";

// 4. Include any default map overrides here

// 5. Include remainder of required parts
@import "../node_modules/bootstrap/scss/maps";
@import "../node_modules/bootstrap/scss/mixins";
@import "../node_modules/bootstrap/scss/root";

//// Optional components
//@import "../node_modules/bootstrap/scss/utilities";
@import "../node_modules/bootstrap/scss/reboot";
@import "../node_modules/bootstrap/scss/containers";
@import "../node_modules/bootstrap/scss/forms";
@import "../node_modules/bootstrap/scss/vendor/rfs";


h1 {
  @include margin-bottom(3rem);
  text-align : center;
}


.py-3 {
  padding-block : 1rem;
}


.mb-3 {
  margin-bottom : 1rem;
}


a:not(:hover, :focus-visible) {
  text-decoration : none;
}
</style>
